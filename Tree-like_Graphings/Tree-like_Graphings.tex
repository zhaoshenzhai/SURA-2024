\documentclass{amsart}
\input{setup/preamble.sty}
\input{setup/macros.sty}

\begin{document}
    \title{Tree-like Graphings}
    \author{Zhaoshen Zhai}
    \date{\today}

    \begin{abstract}
        We present a streamlined exposition of a construction presented in \cite{CPTT23}, where it is proven that every locally-finite Borel graph with each component a quasi-tree induces a canonical treeable equivalence relation. {\color{red}{Write some more details...}}
    \end{abstract}

    \maketitle

    \section{Introduction}

    The purpose of this note is to provide a streamlined proof of a particular case of a construction presented in \cite{CPTT23}, in order to better understand the general formalism developed therein. We attempt to make this note self-contained, but nevertheless urge the reader to refer to the original paper for more detailed discussion and some generalizations of the results we have selected to include here.

    \subsection{Treeings of equivalence relations}

    A \textit{countable Borel equivalence relation (CBER)} on a standard Borel space $X$ is a Borel equivalence relation $E\subseteq X^2$ with each class countable. We are interested in special types of \textit{graphings} on a CBER $E\subseteq X^2$, i.e. a Borel graph $G\subseteq X^2$ whose connectedness relation is precisely $E$. For instance, a graphing of $E$ such that each component is a tree is called a \textit{treeing} of $E$, and the CBERs that admit treeings are said to be \textit{treeable}. The main results of \cite{CPTT23} provide new sufficient criteria for treeability of certain classes of CBERs, and in particular, they prove the following

    \begin{mainTheorem}[\cite{CPTT23}*{Theorem 1.1}]
        If a CBER admits a locally-finite graphing whose components are quasi-trees, then it is treeable.
    \end{mainTheorem}

    Recall that metric spaces $X$ and $Y$ are \textit{quasi-isometric} if they are isometric up to a bounded multiplicative and additive error, and $X$ is a \textit{quasi-tree} if it is quasi-isometric to a simplicial tree; see \cite{Gro93} and \cite{DK18}.

    \subsection{Outline of the proof}

    Roughly speaking, the existence of a quasi-isometry $G|C\to T_C$ to a simplicial tree $T_C$ for each component $C\subseteq X$ induces a collection $\mc{H}(C)$ of `cuts' (subsets $H\subseteq C$ with finite boundary such that both $H$ and $C\comp H$ are connected), which are `tree-like' in the sense that
    \begin{enumerate}
        \item[1.] $\mc{H}(C)$ is \textit{finitely-separating}: each pair $x,y\in C$ is separated by finitely-many $H\in\mc{H}(C)$, and
        \item[2.] $\mc{H}(C)$ is \textit{dense towards ends}: each end in $G|C$ has a neighborhood basis in $\mc{H}(C)$.
    \end{enumerate}
    By Condition (1), these cuts have the structure of a profinite pocset with non-trivial points isolated, which in turn provide exactly the data to construct a `median graph' whose vertices are `ultrafilters'\footnote{As in \cite{CPTT23}, we call them \textit{orientations} instead, to avoid confusion with the more standard notion; see Definition \ref{def:orientation}.} thereof. Condition (2) then ensures that this graph has finite `hyperplanes', which allows us to apply a Borel `cycle-cutting' algorithm and obtain a canonical spanning tree thereof. Each step above can be done in a uniform way to each component $C\subseteq G$, giving us the desired treeing of the CBER.
    \begin{equation*}
        \textrm{Quasi-tree}
            \ \ \xrightarrow{\ref{sec:graphs_with_dense_family_of_cuts}}\ \ 
        \begin{gathered}
            \textrm{Dense family} \\[-4pt]
            \textrm{of cuts}
        \end{gathered}
            \ \ \xrightarrow{\ref{sec:pocsets_of_cuts}}\ \ 
        \begin{gathered}
            \textrm{Pocset w/} \\[-4pt]
            \textrm{non-triv. pts.} \\[-4pt]
            \textrm{isolated}
        \end{gathered}
            \ \ \xrightarrow{\ref{sec:the_dual_median_graph_of_a_pocset}}\ \ 
        \begin{gathered}
            \textrm{Median graph} \\[-4pt]
            \textrm{w/ finite} \\[-4pt]
            \textrm{hyperplanes}
        \end{gathered}
            \ \ \xrightarrow{\ref{sec:spanning_trees_of_median_graphs_with_finite_hyperplanes}}\ \ 
        \begin{gathered}
            \textrm{Canonical} \\[-4pt]
            \textrm{spanning tree}
        \end{gathered}
    \end{equation*}

    {\color{red}{Write some more stuff to tie things together...}}

    \begin{remark*}
        We follow \cite{CPTT23}*{Convention 2.7}, where for a family $\mc{H}\subseteq2^X$ of subsets of a fixed set $X$, we write $\mc{H}^\ast\coloneqq\mc{H}\comp\l\{\em,X\r\}$ for the \textit{non-trivial} elements of $\mc{H}$.
    \end{remark*}

    \section{Graphs with Dense Families of Cuts}\label{sec:graphs_with_dense_family_of_cuts}

    \subsection{Ends of graphs}

    Let $(X,G)$ be a locally-finite graph.

    \begin{definition}
        For a subset $A\subseteq X$, we let $\del_\sf{iv}A\coloneqq A\cap\Ball_1(\lnot A)$ be its \textit{inner vertex boundary}, $\del_\sf{ov}A\coloneqq\del_\sf{iv}(\lnot A)$ be its \textit{outer vertex boundary}, and let $\del_\sf{ie}A\coloneqq G\cap(\del_\sf{ov}A\times\del_\sf{iv}A)$ and $\del_\sf{oe}A\coloneqq\del_\sf{ie}(\lnot A)$ respectively be its \textit{inner} and \textit{outer edge boundaries}. Let $\del_\sf{v}A\coloneqq\del_\sf{iv}A\cup\del_\sf{ov}A$ be the \textit{(total) vertex boundary} of $A$.
    \end{definition}

    Let $\mc{H}_{\del<\infty}(X)\subseteq2^X$ be the Boolean algebra of all $A\subseteq X$ with finite vertex boundary, called \textit{cuts} in $X$.

    \begin{definition}
        The \textit{end compactification} of $(X,G)$ is the Stone space $\widehat{X}$ of $\mc{H}_{\del<\infty}(X)$, whose non-principal ultrafilters are the \textit{ends} of $(X,G)$.
    \end{definition}

    We identify $X\into\widehat{X}$ via principal ultrafilter map $x\mapsto p_x$, so $\widehat{X}\comp X$ is the set of ends of $G$. By definition, $\widehat{X}$ admits a basis of clopen sets of the form $\widehat{A}\coloneqq\{p\in\widehat{X}\st A\in p\}$ for each $A\in\mc{H}_{\del<\infty}(X)$.

    \begin{definition}
        A family $\mc{H}\subseteq\mc{H}_{\del<\infty}(X)$ of cuts is \textit{dense towards ends} of $(X,G)$ if $\mc{H}$ contains a neighborhood basis for every end in $\widehat{X}\comp X$.

        In other words, $\mc{H}$ is dense towards ends if for every $p\in\widehat{X}\comp X$ and every (clopen) neighborhood $\widehat{A}\ni p$, where $A\in\mc{H}_{\del<\infty}(X)$, there is some $H\in\mc{H}$ with $p\in\widehat{H}\subseteq\widehat{A}$; it is useful to note that $\widehat{H}\subseteq\widehat{A}$ iff $H\subseteq A$.
    \end{definition}

    \subsection{Dense cuts induced by quasi-isometries}

    If $X$ is a quasi-tree $-$ and thus does not have arbitrary long cycles $-$ we expect that there is some finite bound $R<\infty$ such that the ends in $\widehat{X}\comp X$ are `limits' of cuts $\mc{H}_{\diam(\del)\leq R}(X)\subseteq\mc{H}_{\del<\infty}(X)$ with boundary diameter bounded by $R$. We show that this is indeed the case, in the sense that $\mc{H}_{\diam(\del)\leq R}(X)$ is dense towards ends of $(X,G)$.

    \begin{lemma}\label{lem:coarse_equivalence_controls_boundary_diameter}
        Let $f:(X,G)\to(Y,T)$ be a coarse-equivalence between connected locally-finite graphs. For a fixed $H\in\mc{H}_{\del<\infty}(Y)$, $\diam(\del_\sf{v}f^{-1}(H))$ is uniformly bounded in terms of $\diam(\del_\sf{v}H)$.
    \end{lemma}
    \begin{proof}
        Since $f$ is bornologous, let $S<\infty$ be such that $xGx'$ implies $d(f(x),f(x'))\leq S$, so that for any $(x,x')\in\del_\sf{ie}f^{-1}(H)$, there is a path of length $\leq S$ between $f(x)\not\in H$ and $f(x')\in H$. Thus both $d(f(x),\del_\sf{v}H)$ and $d(f(x'),\del_\sf{v}H)$ are bounded by $S$, so $f(\del_\sf{v}f^{-1}(H))\subseteq\Ball_S(\del_\sf{v}H)$ and hence
        \begin{equation*}
            \diam(f(\del_\sf{v}f^{-1}(H)))\leq\diam(\del_\sf{v}H)+2S.
        \end{equation*}
        That $f$ is a coarse-\textit{equivalence} gives us a uniform bound of $\diam(\del_\sf{v}f^{-1}(H))$ in terms of $\diam(\del_\sf{v}H)$.
    \end{proof}

    In particular, if $\diam(\del_\sf{v}H)$ is itself also uniformly bounded, then so is $\diam(\del_\sf{v}f^{-1}(H))$.

    \begin{proposition}\label{prp:invariant_of_density_coarse_equivalence}
        The class of connected locally-finite graphs in which $\mc{H}_{\diam(\del)\leq R}$ is dense towards ends for some $R<\infty$ is invariant under coarse equivalence.
    \end{proposition}
    \begin{proof}
        Let $(X,G)$, $(Y,T)$ be connected locally-finite graphs, $f:X\to Y$ be a coarse equivalence with quasi-inverse $g:Y\to X$, and suppose $\mc{H}_{\diam(\del)\leq S}(Y)$ is dense towards ends for some $S<\infty$. By Lemma \ref{lem:coarse_equivalence_controls_boundary_diameter}, pick some $R<\infty$ so that for any $H\in\mc{H}_{\diam(\del)\leq S}(Y)$, we have $f^{-1}(H)\in\mc{H}_{\diam(\del)\leq R}(X)$.

        Fix an end $U\in\widehat{X}\comp X$ with $U\in\widehat{A}$ for some $A\in\mc{H}_{\del<\infty}(X)$. We need to find some $B\in\mc{H}_{\del<\infty}(Y)$ such that $\widehat{f}(U)\in\widehat{B}$ and $f^{-1}(B)\subseteq A$, for then $\widehat{f}(U)\in\widehat{H}$ for some $B\supseteq H\in\mc{H}_{\diam(\del)\leq S}(Y)$, and hence we have
        \begin{equation*}
            U\in\widehat{f^{-1}(H)}\subseteq\widehat{f^{-1}(B)}\subseteq\widehat{A}
        \end{equation*}
        with $f^{-1}(H)\in\mc{H}_{\diam(\del)\leq R}(X)$. For convenience, let $D<\infty$ be the uniform distance $d(1_X,g\circ f)$.

        To this end, note that $\widehat{f}(U)\in\widehat{B}$ iff $U\in\widehat{f^{-1}(B)}$. Since $U\in\widehat{A}$, the latter can occur if $|A\symdiff f^{-1}(B)|<\infty$, and so we need to find such a $B\in\mc{H}_{\del<\infty}(Y)$ with the additional property that $f^{-1}(B)\subseteq A$.
        \begin{leftbar}
            \textit{Attempt 1.} Set $B\coloneqq g^{-1}(A)\in\mc{H}_{\del<\infty}(Y)$. Then $f^{-1}(B)\subseteq\Ball_D(A)$ since if $(g\circ f)(x)\in A$, then
                \begin{equation*}
                    d(x,A)\leq d(x,(g\circ f)(x))\leq d(1_X,g\circ f)=D.
                \end{equation*}
            By local-finiteness of $G$, we see that $A\symdiff f^{-1}(B)=A\comp f^{-1}(B)$ is finite, as desired.
        \end{leftbar}
        However, it is \textit{not} the case that $f^{-1}(B)\subseteq A$. To remedy this, we `shrink' $A$ by $D$ to $A'$ so that $\Ball_D(A')\subseteq A$, and take $B\coloneqq g^{-1}(A')$ instead. Indeed, $A'\coloneqq\lnot\Ball_D(\lnot A)\subseteq A$ works, since $f^{-1}(B)\subseteq\Ball_D(A')$ as before, so $A'\symdiff f^{-1}(B)=A'\comp f^{-1}(B)$ is finite. Also, $A\symdiff A'$ is finite since $x\in A\symdiff A'$ iff $x\in A$ and $d(x,\lnot A)\leq D$, so $A\symdiff f^{-1}(B)$ is finite too. It remains to show that $\Ball_D(A')\subseteq A$, for then $f^{-1}(B)\subseteq A$ as desired.

        Indeed, if $y\in\Ball_D(A')$, then by the (reverse) triangle-inequality we have $d(y,\lnot A)\geq d(x,\lnot A)-d(x,y)$ for all $x\in A'$. But $d(x,\lnot A)>D$, strictly, so $d(y,\lnot A)>D-D=0$, and hence $y\in A$.
    \end{proof}

    \begin{corollary}
        If $(X,G)$ is a locally-finite quasi-tree, then $\mc{H}_{\diam(\del)\leq R}$ is dense towards ends of $G$ for some $R<\infty$.
    \end{corollary}
    \begin{proof}
        Observe that $\mc{H}_{\diam(\del)\leq2}(T)$ is dense towards ends for any tree $T$, and invoke Proposition \ref{prp:invariant_of_density_coarse_equivalence}.
    \end{proof}

    \section{Pocsets and Orientations}

    \subsection{Pocsets of cuts}\label{sec:pocsets_of_cuts}

    The family $\mc{H}_{\diam\del\leq R}(X)$ of cuts have the structure of a `profinite pocset', which we first study abstractly. We then deduce some properties of the pocset induced by a \textit{dense} family of cuts.

    \subsubsection{Abstract profinite pocsets}\label{ssec:profinite_pocsets}

    \begin{definition}
        A \textit{pocset} $(\mc{H},\leq,\lnot,0)$ is a poset $(\mc{H},\leq)$ equipped with an order-reversing involution $\lnot:\mc{H}\to\mc{H}$ and a least element $0\neq\lnot0$ such that $0$ is the only lower-bound of $H,\lnot H$ for every $H\in\mc{H}$.

        A \textit{profinite pocset} is a pocset $\mc{H}$ equipped with a compact topology making $\lnot$ continuous and is \textit{totally order-disconnected}, in the sense that if $H\not\leq K$, then there is a clopen upward-closed $U\subseteq\mc{H}$ with $H\in U\not\ni K$.
    \end{definition}

    \begin{remark}
        Such a topology is automatically Hausdorff and zero-dimensional.
    \end{remark}

    We are primarily interested in subpocsets of $(2^X,\subseteq,\lnot,\em)$, which is profinite if equipped with the product topology of the discrete space $2$. Indeed, $2^X$ admits a base of \textit{cylinder sets} $-$ which are finite intersections of sets of the form $\pi^{-1}_x(i)$ where $x\in X$, $i\in\l\{0,1\r\}$, and $\pi_x:2^X\to2$ is the projection $-$ making $\lnot$ continuous since cylinders are clopen. {\color{red}{Show that it is totally order-disconnected.}}

    The following proposition gives a sufficient criteria for subpocsets of $2^X$ to be profinite. We also show in this case that every non-trivial element $H\in\mc{H}^\ast$ is isolated, which will important in Section \ref{sec:the_dual_median_graph_of_a_pocset}.

    \begin{proposition}\label{prp:finitely-separating_non-trivial_isolated}
        Let $X$ be a set and $\mc{H}\subseteq2^X$ be a subpocset. If $\mc{H}$ is finitely-separating, then $\mc{H}\subseteq2^X$ is closed and every non-trivial element is isolated.
    \end{proposition}
    \begin{proof}
        It suffices to show that the limit points of $\mc{H}$ are trivial, so let $A\in2^X\comp\l\{\em,X\r\}$. Fix $x\in A\not\ni y$. Since $\mc{H}$ is finitely-separating, there are finitely-many $H\in\mc{H}$ with $x\in H\not\ni y$, and for each such $H\in\mc{H}\comp\l\{A\r\}$, we have either some $x_H\in A\comp H$ or $y_H\in H\comp A$. Let $U\subseteq2^X$ be the family of all subsets $B\subseteq X$ containing $x$ and each $x_H$ but not $y$ or any $y_H$.

        This is the desired neighborhood isolating $A\in U$. Indeed, it is (cl)open since it is the \textit{finite} intersection of cylinders prescribed by the $x_H$'s and $y_H$'s, and it is disjoint from $\mc{H}\comp\l\{A\r\}$ by construction.
    \end{proof}

    \subsubsection{Finiteness conditions on the pocset of a dense family of cuts}

    \subsection{The dual median graph of a pocset}\label{sec:the_dual_median_graph_of_a_pocset}

    Let $\mc{H}\subseteq2^X$ be a finitely-separating subpocset, whose elements we call \textit{half-spaces}. By Proposition \ref{prp:finitely-separating_non-trivial_isolated}, $\mc{H}$ is profinite and every non-trivial element thereof is isolated.
    
    \subsubsection{Median graph of orientations}

    \begin{definition}\label{def:orientation}
        An \textit{orientation} on $\mc{H}$ is an upward-closed subset $U\subseteq\mc{H}$ containing exactly one of $H,\lnot H$ for each $H\in\mc{H}$. We let $\mc{U}(\mc{H})$ denote the set of all orientations on $\mc{H}$ and let $\mc{U}^\circ(\mc{H})$ denote the clopen ones.
    \end{definition}

    {\color{red}{The \textit{clopen} orientations are exactly those which are \textit{finitely-based}, in the sense that there is a $\subseteq$-minimal finite subset $U_0\subseteq U$ such that $U=\,\,\uparrow\!U_0$, where
    \begin{equation*}
        \uparrow\!U_0\coloneqq\bigcup_{H\in U_0}\!\uparrow\!H\coloneqq\bigcup_{H\in U_0}\!\l\{K\in\mc{H}:K\supseteq H\r\}.
    \end{equation*}
    Indeed, if $U$ is clopen, then there is a finite subset $A\subseteq X$ such that for all $H\in\mc{H}$, we have $H\in U$ iff there is some $K\in U$ with $H\cap A=K\cap A$.}}

    \begin{example}
        Every $x\in X$ induces its \textit{principal orientation} $\widehat{x}\coloneqq\l\{H\in\mc{H}\st x\in H\r\}=\mc{H}\cap\pi^{-1}_x(1)$, which is clearly clopen in $\mc{H}$, and gives us a canonical map $\mf{p}:X\to\mc{U}^\circ(\mc{H})$. Note, however, that $\mf{p}$ is \textit{not necessarily} injective; we call a fiber $[x]_\mc{H}\coloneqq\mf{p}^{-1}(\widehat{x})=\l\{y\in X\st\widehat{x}=\widehat{y}\r\}$ an \textit{$\mc{H}$-block}.
    \end{example}

    \begin{remark}
        Intuitively, an orientation is a `maximally consistent' choice of half-spaces. To formalize this, let $\sim$ be the equivalence relation on $\mc{H}$ given by $H\sim\lnot H$, and let $\del:\mc{H}\to\mc{H}/\!\!\sim$ be the quotient map. Orientations $U\subseteq\mc{H}$ then correspond precisely to sections $\phi:\mc{H}/\!\!\sim\,\to\mc{H}$ of $\del$ such that $\phi(\del H)\not\subseteq\lnot\phi(\del K)$ for every $H,K\in\mc{H}$; the latter condition rules out `orientations' of the form $\leftarrow\hspace{-4.7pt}|\,\,|\hspace{-4.7pt}\rightarrow$.
    \end{remark}

    The goal of this section is to canonically construct a graph whose vertices are clopen orientations on $\mc{H}$.

    \begin{theorem}\label{thm:construction_of_dual_median_graph}
        Let $\mc{H}\subseteq2^X$ be a finitely-separating subpocset. Then ...
    \end{theorem}

    \subsubsection{Finiteness conditions on $\mc{U}^\circ(\mc{H})$}

    \section{Median Graphs and their Canonical Spanning Trees}\label{sec:spanning_trees_of_median_graphs_with_finite_hyperplanes}

    \begin{appendices}
        \section{Tree of orientations on a nested pocset of sets}

        Let $\mc{H}\subseteq2^X$ be a finitely-separating subpocset (see Definition \ref{ssec:profinite_pocsets}), so every non-trivial element is isolated by Proposition \ref{prp:finitely-separating_non-trivial_isolated}. As shown in Theorem \ref{thm:construction_of_dual_median_graph}, the clopen orientations $\mc{U}^\circ(\mc{H})$ form the vertices of a median graph, whose edges are given by `minimal base-flipping'.

        We devote this appendix to show that if $\mc{H}$ is \textit{nested}, then $\mc{U}^\circ(\mc{H})$ is in fact a tree, and so we may bypass the Borel cycle-cutting algorithm in Section \ref{sec:spanning_trees_of_median_graphs_with_finite_hyperplanes} and obtain a treeing directly.
    \end{appendices}

    \begin{bibdiv}
        \begin{biblist}*{labels={alphabetic}}
            \bibselect{setup/bibliography}
        \end{biblist}
    \end{bibdiv}
\end{document}
