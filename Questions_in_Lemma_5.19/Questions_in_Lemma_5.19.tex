\documentclass{amsart}
\input{preamble.sty}
\input{macros.sty}

\begin{document}
    \title{Questions in Lemma 5.19}
    \author{Zhaoshen Zhai}
    \date{\today}
    \maketitle

    \newcommand{\Ball}{\operatorname{Ball}}

    \section{Results from the Paper}

    I'll first reference a previous lemma, and then reproduce Lemma \ref{lem:5.19} and its proof here.

    \setcounter{section}{2}
    \setcounter{theorem}{66}
    \begin{lemma}\label{lem:2.67}
        Let $(X,G)$, $(Y,H)$ be connected locally-finite graphs. For a coarse embedding $f:X\to Y$ and $A\in\mc{H}_{\del<\infty}(Y)$, $\diam(\del_\sf{v}f^{-1}(A))$ is uniformly bounded in terms of $\diam(\del_\sf{v}A)$, and also $f^{-1}(A)\in\mc{H}_{\del<\infty}(X)$.
    \end{lemma}

    \setcounter{section}{5}
    \setcounter{theorem}{18}
    \begin{lemma}\label{lem:5.19}
        The class of connected locally-finite graphs in which $\mc{H}_{\diam(\del)\leq R}$ is dense towards ends for some $R<\infty$ is invariant under coarse equivalence.
    \end{lemma}
    \begin{proof}
        Let $(X,G)$, $(Y,T)$ be connected locally-finite graphs, $f:X\to Y$ be a coarse equivalence with quasi-inverse $g:Y\to X$, and suppose $\mc{H}_{\diam(\del)\leq S}(Y)$ is dense towards ends for some $S<\infty$. By Lemma \ref{lem:2.67}, pick some $R<\infty$ so that for any $H\in\mc{H}_{\diam(\del)\leq S}(Y)$, we have $f^{-1}(H)\in\mc{H}_{\diam(\del)\leq R}(X)$. Then for any $U\in\widehat{X}\comp X$ and $A\in\mc{H}_{\del<\infty}(X)$ with $U\in\widehat{A}$, letting $B\coloneqq\lnot\Ball_{d(1_X,g\circ f)}(\lnot A)$, we have $f^{-1}(g^{-1}(B))\subseteq\Ball_{d(1_X,g\circ f)}(B)\subseteq A$, and $A\symdiff B$, $B\symdiff f^{-1}(g^{-1}(B))$ are finite, so $U\in\widehat{f^{-1}(g^{-1}(B))}$, so $\widehat{f}(U)\in\widehat{g^{-1}(B)}$, so there is $g^{-1}(B)\supseteq H\in\mc{H}_{\diam(\del)\leq S}(Y)$ with {\color{red}{$\widehat{f}(U)\in H$}}\footnote{I think this should be $H\in\widehat{f}(U)$, or equivalently $\widehat{f}(U)\in\widehat{H}$.}, so $f^{-1}(H)\in\mc{H}_{\diam(\del)\leq R}(X)$ with $U\in\widehat{f^{-1}(H)}$ and $f^{-1}(H)\subseteq f^{-1}(g^{-1}(B))\subseteq A$.
    \end{proof}

    \setcounter{section}{1}
    \section{Detailed Proof to Check my Understanding}

    I'll give some details in the proof and rewrite it in a way that I can understand, in order to ask you if my understanding of this proof is correct (as it is a very important step towards a generalization/modification).

    \begin{proof}
        Let $(X,G)$, $(Y,T)$, $f:X\to Y$ and $g:Y\to X$ be as above, $\mc{H}_{\diam(\del)\leq S}(Y)$ be dense towards ends, and $R<\infty$ be so that for any $H\in\mc{H}_{\diam(\del)\leq S}(Y)$, we have $f^{-1}(H)\in\mc{H}_{\diam(\del)\leq R}(X)$.

        Fix an end $U\in\widehat{X}\comp X$ with $U\in\widehat{A}$ for some $A\in\mc{H}_{\del<\infty}(X)$. We need to find some\footnote{Warning: My $B\in\mc{H}_{\del<\infty}(Y)$ is \textit{not} the same $B$ as in the original proof.} $B\in\mc{H}_{\del<\infty}(Y)$ such that $\widehat{f}(U)\in\widehat{B}$ and $f^{-1}(B)\subseteq A$, for then $\widehat{f}(U)\in\widehat{H}$ for some $B\supseteq H\in\mc{H}_{\diam(\del)\leq S}(Y)$, and hence we have
        \begin{equation*}
            U\in\widehat{f^{-1}(H)}\subseteq\widehat{f^{-1}(B)}\subseteq\widehat{A}
        \end{equation*}
        with $f^{-1}(H)\in\mc{H}_{\diam(\del)\leq R}(X)$. For convenience, let $D<\infty$ be the uniform distance $d(1_X,g\circ f)$.

        To this end, note that $\widehat{f}(U)\in\widehat{B}$ iff $U\in\widehat{f^{-1}(B)}$. Since $U\in\widehat{A}$, the latter can occur if $|A\symdiff f^{-1}(B)|<\infty$, and so we need to find such a $B\in\mc{H}_{\del<\infty}(Y)$ with the additional property that $f^{-1}(B)\subseteq A$.
        \begin{itemize}
            \item \textit{Attempt 1:} Set $B\coloneqq g^{-1}(A)\in\mc{H}_{\del<\infty}(Y)$. Then $f^{-1}(B)\subseteq\Ball_D(A)$ since if $(g\circ f)(x)\in A$, then
                \begin{equation*}
                    d(x,A)\leq d(x,(g\circ f)(x))\leq d(1_X,g\circ f)=D.
                \end{equation*}
            By local-finiteness of $G$, we see that $A\symdiff f^{-1}(B)=A\comp f^{-1}(B)$ is finite, as desired.
        \end{itemize}
        However, it is \textit{not} the case that $f^{-1}(B)\subseteq A$. To remedy this, we `shrink' $A$ by $D$ to $A'$ so that $\Ball_D(A')\subseteq A$, and take $B\coloneqq g^{-1}(A')$ instead. Indeed, $A'\coloneqq\lnot\Ball_D(\lnot A)\subseteq A$ works, since $f^{-1}(B)\subseteq\Ball_D(A')$ as before, so $A'\symdiff f^{-1}(B)=A'\comp f^{-1}(B)$ is finite. Also, $A\symdiff A'$ is finite since $x\in A\symdiff A'$ iff $x\in A$ and $d(x,\lnot A)\leq D$, so $A\symdiff f^{-1}(B)$ is finite too. It remains to show that $\Ball_D(A')\subseteq A$, for then $f^{-1}(B)\subseteq A$ as desired.

        Indeed, if $y\in\Ball_D(A')$, then by the (reverse) triangle-inequality we have $d(y,\lnot A)\geq d(x,\lnot A)-d(x,y)$ for all $x\in A'$. But $d(x,\lnot A)>D$, strictly, so $d(y,\lnot A)>D-D=0$, and hence $y\in A$.
    \end{proof}
\end{document}
